@model MedShare.Models.Medicamento

@{
    ViewData["Title"] = "Cadastrar Medicamento";
}

<link rel="stylesheet" href="~/css/medicamentos/medicamentos.css" />

<div class="medicamentos-container">
    <!-- Header da P√°gina -->
    <div class="page-header">
        <h1>
            <i class="fas fa-plus-circle"></i>
            Cadastrar Novo Medicamento
        </h1>
        <p>Adicione um novo medicamento √† lista de necessidades da sua institui√ß√£o</p>
    </div>

    <!-- Formul√°rio de Cadastro -->
    <div class="form-container">
        <form asp-action="Create" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            
            <!-- Linha 1: Nome e Categoria -->
            <div class="form-row">
                <div class="form-group">
                    <label asp-for="Nome" class="control-label">
                        <i class="fas fa-pills"></i>
                        Nome do Medicamento *
                    </label>
                    <input asp-for="Nome" class="form-control" placeholder="Ex: Paracetamol, Ibuprofeno..." />
                    <span asp-validation-for="Nome" class="text-danger"></span>
                </div>
                
                <div class="form-group">
                    <label asp-for="Categoria" class="control-label">
                        <i class="fas fa-tags"></i>
                        Categoria *
                    </label>
                    <select asp-for="Categoria" class="form-control">
                        <option value="">Selecione uma categoria</option>
                        <option value="Antibi√≥ticos">Antibi√≥ticos</option>
                        <option value="Analg√©sicos">Analg√©sicos</option>
                        <option value="Anti-inflamat√≥rios">Anti-inflamat√≥rios</option>
                        <option value="Cardiovasculares">Cardiovasculares</option>
                        <option value="Diabetes">Diabetes</option>
                        <option value="Respirat√≥rios">Respirat√≥rios</option>
                        <option value="Neurol√≥gicos">Neurol√≥gicos</option>
                        <option value="Gastrointestinais">Gastrointestinais</option>
                        <option value="Vitaminas e Minerais">Vitaminas e Minerais</option>
                        <option value="Outros">Outros</option>
                    </select>
                    <span asp-validation-for="Categoria" class="text-danger"></span>
                </div>
            </div>

            <!-- Linha 2: Dosagem e Forma Farmac√™utica -->
            <div class="form-row">
                <div class="form-group">
                    <label asp-for="Dosagem" class="control-label">
                        <i class="fas fa-prescription-bottle-alt"></i>
                        Dosagem *
                    </label>
                    <input asp-for="Dosagem" class="form-control" placeholder="Ex: 500mg, 10ml, 1 comprimido..." />
                    <span asp-validation-for="Dosagem" class="text-danger"></span>
                </div>
                
                <div class="form-group">
                    <label asp-for="FormaFarmaceutica" class="control-label">
                        <i class="fas fa-capsules"></i>
                        Forma Farmac√™utica
                    </label>
                    <select asp-for="FormaFarmaceutica" class="form-control">
                        <option value="">Selecione a forma</option>
                        <option value="Comprimido">Comprimido</option>
                        <option value="C√°psula">C√°psula</option>
                        <option value="Xarope">Xarope</option>
                        <option value="Solu√ß√£o">Solu√ß√£o</option>
                        <option value="Suspens√£o">Suspens√£o</option>
                        <option value="Inje√ß√£o">Inje√ß√£o</option>
                        <option value="Pomada">Pomada</option>
                        <option value="Gel">Gel</option>
                        <option value="Creme">Creme</option>
                        <option value="Gotas">Gotas</option>
                        <option value="Spray">Spray</option>
                        <option value="Adesivo">Adesivo</option>
                        <option value="Outros">Outros</option>
                    </select>
                    <span asp-validation-for="FormaFarmaceutica" class="text-danger"></span>
                </div>
            </div>

            <!-- Linha 3: Prioridade e Quantidades -->
            <div class="form-row">
                <div class="form-group">
                    <label asp-for="NivelPrioridade" class="control-label">
                        <i class="fas fa-star"></i>
                        N√≠vel de Prioridade *
                    </label>
                    <select asp-for="NivelPrioridade" class="form-control" id="prioridadeSelect">
                        <option value="">Selecione a prioridade</option>
                        <option value="5">5 - Muito Alta (Medicamento essencial/vida)</option>
                        <option value="4">4 - Alta (Importante para tratamento)</option>
                        <option value="3">3 - M√©dia (Necess√°rio regularmente)</option>
                        <option value="2">2 - Baixa (Uso eventual)</option>
                        <option value="1">1 - Muito Baixa (Reserva/opcional)</option>
                    </select>
                    <span asp-validation-for="NivelPrioridade" class="text-danger"></span>
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i>
                        A prioridade ajuda a identificar medicamentos cr√≠ticos em situa√ß√µes de escassez
                    </small>
                </div>
                
                <div class="form-group">
                    <label asp-for="QuantidadeNecessaria" class="control-label">
                        <i class="fas fa-boxes"></i>
                        Quantidade Necess√°ria *
                    </label>
                    <input asp-for="QuantidadeNecessaria" class="form-control" type="number" min="1" placeholder="Ex: 100" />
                    <span asp-validation-for="QuantidadeNecessaria" class="text-danger"></span>
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i>
                        Quantidade ideal em estoque para suprir a demanda
                    </small>
                </div>
            </div>

            <!-- Linha 4: Estoque Atual -->
            <div class="form-row">
                <div class="form-group">
                    <label asp-for="QuantidadeAtual" class="control-label">
                        <i class="fas fa-warehouse"></i>
                        Quantidade Atual em Estoque
                    </label>
                    <input asp-for="QuantidadeAtual" class="form-control" type="number" min="0" placeholder="Ex: 25" value="0" />
                    <span asp-validation-for="QuantidadeAtual" class="text-danger"></span>
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i>
                        Quantidade atualmente dispon√≠vel em estoque
                    </small>
                </div>
                
                <!-- Preview do Status -->
                <div class="form-group">
                    <label class="control-label">
                        <i class="fas fa-chart-line"></i>
                        Preview do Status
                    </label>
                    <div id="statusPreview" style="padding: 12px; border-radius: 8px; background: #f3f4f6;">
                        <span id="statusBadge" class="status-badge status-normal">
                            ‚úÖ Aguardando dados
                        </span>
                        <div style="margin-top: 10px;">
                            <div class="estoque-progress">
                                <div id="statusProgress" class="estoque-fill estoque-normal" style="width: 0%"></div>
                            </div>
                            <small id="statusPercentual">0%</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Descri√ß√£o -->
            <div class="form-row">
                <div class="form-group" style="flex: 1; min-width: 100%;">
                    <label asp-for="Descricao" class="control-label">
                        <i class="fas fa-align-left"></i>
                        Descri√ß√£o
                    </label>
                    <textarea asp-for="Descricao" class="form-control" rows="3" 
                              placeholder="Informa√ß√µes adicionais sobre o medicamento, indica√ß√µes, restri√ß√µes, etc."></textarea>
                    <span asp-validation-for="Descricao" class="text-danger"></span>
                </div>
            </div>

            <!-- Observa√ß√µes -->
            <div class="form-row">
                <div class="form-group" style="flex: 1; min-width: 100%;">
                    <label asp-for="Observacoes" class="control-label">
                        <i class="fas fa-sticky-note"></i>
                        Observa√ß√µes
                    </label>
                    <textarea asp-for="Observacoes" class="form-control" rows="2" 
                              placeholder="Observa√ß√µes internas, notas sobre fornecedores, etc."></textarea>
                    <span asp-validation-for="Observacoes" class="text-danger"></span>
                </div>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i>
                    Cadastrar Medicamento
                </button>
                
                <a asp-action="Index" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i>
                    Voltar √† Lista
                </a>
                
                <button type="reset" class="btn" style="background: #6b7280; color: white;">
                    <i class="fas fa-eraser"></i>
                    Limpar Formul√°rio
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Script para Preview do Status -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const quantidadeNecessaria = document.querySelector('input[name="QuantidadeNecessaria"]');
    const quantidadeAtual = document.querySelector('input[name="QuantidadeAtual"]');
    const statusBadge = document.getElementById('statusBadge');
    const statusProgress = document.getElementById('statusProgress');
    const statusPercentual = document.getElementById('statusPercentual');

    function atualizarPreview() {
        const necessaria = parseInt(quantidadeNecessaria.value) || 0;
        const atual = parseInt(quantidadeAtual.value) || 0;
        
        if (necessaria === 0) {
            statusBadge.textContent = '‚ö†Ô∏è Defina a quantidade necess√°ria';
            statusBadge.className = 'status-badge status-baixo';
            statusProgress.style.width = '0%';
            statusProgress.className = 'estoque-fill estoque-normal';
            statusPercentual.textContent = '0%';
            return;
        }

        const porcentagem = (atual / necessaria) * 100;
        const porcentagemArredondada = Math.round(porcentagem * 10) / 10;
        
        // Determinar status
        let status, classe, icone;
        if (atual < (necessaria * 0.3)) {
            status = 'Escassez Cr√≠tica';
            classe = 'status-escassez';
            icone = 'üö®';
            statusProgress.className = 'estoque-fill estoque-critico';
        } else if (porcentagem < 50) {
            status = 'Estoque Baixo';
            classe = 'status-baixo';
            icone = '‚ö†Ô∏è';
            statusProgress.className = 'estoque-fill estoque-baixo';
        } else {
            status = 'Estoque Normal';
            classe = 'status-normal';
            icone = '‚úÖ';
            statusProgress.className = 'estoque-fill estoque-normal';
        }

        statusBadge.textContent = `${icone} ${status}`;
        statusBadge.className = `status-badge ${classe}`;
        statusProgress.style.width = `${Math.min(porcentagem, 100)}%`;
        statusPercentual.textContent = `${porcentagemArredondada}%`;
    }

    // Event listeners
    quantidadeNecessaria.addEventListener('input', atualizarPreview);
    quantidadeAtual.addEventListener('input', atualizarPreview);

    // Preview inicial
    atualizarPreview();
});
</script>

<!-- Font Awesome para √≠cones -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />